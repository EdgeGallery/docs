## 特性设计

- [用户注册](#用户注册)
- [单点登录](#单点登录)
- [用户中心](#用户中心)
- [手机验证](#手机验证)
- [邮箱验证](#邮箱验证)
- [访客登录](#访客登录)
- [用户列表管理](#用户列表管理)

| **特性名称** | **特性描述** | **设计约束** |
| --- | --- | --- |
| [用户注册](#用户注册) | 提供用户注册功能。注册时除提供需要注册的用户名外，还可以提供手机号码、邮箱地址。建议二者至少填写一项真实信息，便于忘记密码后找回密码时进行验证。 | 注册时提供的用户名、手机号码、邮箱地址必须是唯一的，如果已存在，则无法成功注册。目前只支持中国大陆手机号注册。 |
| [单点登录（Single Sign On）](#单点登录) | 多个系统共用一个登录认证平台，一次登录就可以访问互相信任的其他应用系统。 | 目前单点登录系统适用于开发者平台（Developer Portal）、应用仓库（Application Store）、管理系统（MEC Manager）、应用测试认证平台（ATP Portal）、社区实验室管理平台（Lab Portal）。 |
| [用户中心](#用户中心) | 用户登录到各应用平台后，可以通过“我的帐号”进入用户中心。在用户中心可以查看/修改个人信息、修改密码。 | 目前不支持修改用户名，只能修改手机号码和邮箱地址。 |
| [手机验证](#手机验证) | 如果用户注册时提供了真实有效的手机号码（或者在用户中心修改个人信息时提供），当忘记密码时可以通过手机号码找回密码。找回密码时需要提供手机号码，系统会向手机号码发送验证码。重置密码时系统会校验验证码是否正确。 | 只有当EdgeGallery平台开启了短信服务才可以通过手机号码找回密码 |
| [邮箱验证](#邮箱验证) | 如果用户注册时提供了真实有效的邮箱地址（或者在用户中心修改个人信息时提供），当忘记密码时可以通过邮箱地址找回密码。找回密码时需要提供邮箱地址，系统会向邮箱地址发送验证码。重置密码时系统会校验验证码是否正确。 | 只有当EdgeGallery平台开启了邮箱服务才可以通过邮箱地址找回密码 |
| [访客登录](#访客登录) | 访客是系统内置的一个GUEST账号，访问首页时自动登录。在访客登录时，用户可以查看系统的大部分功能，但是不能在系统中进行创建/删除/修改登录操作。 | 访客的默认用户名和密码是guest/guest，部署时如需修改密码请通过登录数据库修改，如果想停用GUEST账号，请从数据库中直接删除。 |
| [用户列表管理](#用户列表管理) | 用户管理模块默认内置admin用户，该用户作为系统的超级管理员。为该用户提供一个统一的用户列表管理功能，可以查询用户、启用/停用用户、设置用户角色权限。 | 当停用用户后，用户将无法登录；无法设置已停用用户的角色权限。 |

### 用户注册

用户注册时，用户管理需要完成以下工作：

1.  用户名、手机号码、邮箱地址都需要做唯一性校验
2.  用户名大于6位
3.  用户输入用户名和手机号时，动态调用后台接口，判断用户名或者手机号是否已被注册
    
![注册流程](/uploads/images/2020/0709/165705_b098806f_5504908.png "注册流程.png")

### 单点登录

单点登录系统是基于ServiceComb、Spring Security、Oauth2、JWT、Vue等技术实现，采用OAuth2协议的授权码模式（authorization code），MECM、AppStore、Developer作为客户端，与认证服务器user-mgmt-be进行交互，实现单点登陆与单点注销功能。使用Cookie+Session机制实现用户认证鉴权和超时退出功能，使用JWT存储用户基本信息，减轻认证服务器压力。

#### 单点登录时序图

![单点登录时序图](/uploads/images/2020/0709/165324_cdda101c_5504908.png)

#### 单点注销时序图

![单点注销时序图](/uploads/images/2020/0709/165333_fa1db216_5504908.png)

### 用户中心

### 手机验证

用户管理使用的手机验证来注册和忘记密码。短信业务使用的华为云消息&短信服务，详细信息请点击[这里](https://www.huaweicloud.com/product/msgsms.html)。

```
说明：
1 如果没有购买短信服务，手机验证功能可以通过配置屏蔽，具体步骤如下：
user-mgmt下配置文件application.properties，设置sms.enabled=false
2 目前只满足中国大陆手机号可以注册。
```

### 忘记密码

用户忘记密码时，用户管理需要完成以下工作：

1.  用户输入手机号时，动态调用后台接口，判断手机号是否已被注册，如果已经被注册，可进行下一步发送验证码，如果没有被注册，提示用户先进行注册。
    
2.  修改成功后，返回登录界面。

![忘记密码流程](/uploads/images/2020/0709/165714_12086f92_5504908.png "忘记密码流程.png")


### 界面设计

#### 登录界面

#### 注册界面

#### 忘记密码后找回密码界面

#### 用户中心

#### 用户列表管理

